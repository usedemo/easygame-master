THREE.OrbitControls=function(a,b){function c(){return 2*Math.PI/60/60*o.autoRotateSpeed}function d(){return Math.pow(.95,o.zoomSpeed)}function e(a){if(o.enabled!==!1){if(a.preventDefault(),a.button===o.mouseButtons.ORBIT){if(o.noRotate===!0)return;I=H.ROTATE,q.set(a.clientX,a.clientY)}else if(a.button===o.mouseButtons.ZOOM){if(o.noZoom===!0)return;I=H.DOLLY,y.set(a.clientX,a.clientY)}else if(a.button===o.mouseButtons.PAN){if(o.noPan===!0)return;I=H.PAN,t.set(a.clientX,a.clientY)}I!==H.NONE&&(document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1),o.dispatchEvent(M))}}function f(a){if(o.enabled!==!1){a.preventDefault();var b=o.domElement===document?o.domElement.body:o.domElement;if(I===H.ROTATE){if(o.noRotate===!0)return;r.set(a.clientX,a.clientY),s.subVectors(r,q),o.rotateLeft(2*Math.PI*s.x/b.clientWidth*o.rotateSpeed),o.rotateUp(2*Math.PI*s.y/b.clientHeight*o.rotateSpeed),q.copy(r)}else if(I===H.DOLLY){if(o.noZoom===!0)return;z.set(a.clientX,a.clientY),A.subVectors(z,y),A.y>0?o.dollyIn():A.y<0&&o.dollyOut(),y.copy(z)}else if(I===H.PAN){if(o.noPan===!0)return;u.set(a.clientX,a.clientY),v.subVectors(u,t),o.pan(v.x,v.y),t.copy(u)}I!==H.NONE&&o.update()}}function g(){o.enabled!==!1&&(document.removeEventListener("mousemove",f,!1),document.removeEventListener("mouseup",g,!1),o.dispatchEvent(N),I=H.NONE)}function h(a){if(o.enabled!==!1&&o.noZoom!==!0&&I===H.NONE){a.preventDefault(),a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail),b>0?o.dollyOut():0>b&&o.dollyIn(),o.update(),o.dispatchEvent(M),o.dispatchEvent(N)}}function i(a){if(o.enabled!==!1&&o.noKeys!==!0&&o.noPan!==!0)switch(a.keyCode){case o.keys.UP:o.pan(0,o.keyPanSpeed),o.update();break;case o.keys.BOTTOM:o.pan(0,-o.keyPanSpeed),o.update();break;case o.keys.LEFT:o.pan(o.keyPanSpeed,0),o.update();break;case o.keys.RIGHT:o.pan(-o.keyPanSpeed,0),o.update()}}function j(a){if(o.enabled!==!1){switch(a.touches.length){case 1:if(o.noRotate===!0)return;I=H.TOUCH_ROTATE,q.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(o.noZoom===!0)return;I=H.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);y.set(0,d);break;case 3:if(o.noPan===!0)return;I=H.TOUCH_PAN,t.set(a.touches[0].pageX,a.touches[0].pageY);break;default:I=H.NONE}I!==H.NONE&&o.dispatchEvent(M)}}function k(a){if(o.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=o.domElement===document?o.domElement.body:o.domElement;switch(a.touches.length){case 1:if(o.noRotate===!0)return;if(I!==H.TOUCH_ROTATE)return;r.set(a.touches[0].pageX,a.touches[0].pageY),s.subVectors(r,q),o.rotateLeft(2*Math.PI*s.x/b.clientWidth*o.rotateSpeed),o.rotateUp(2*Math.PI*s.y/b.clientHeight*o.rotateSpeed),q.copy(r),o.update();break;case 2:if(o.noZoom===!0)return;if(I!==H.TOUCH_DOLLY)return;var c=a.touches[0].pageX-a.touches[1].pageX,d=a.touches[0].pageY-a.touches[1].pageY,e=Math.sqrt(c*c+d*d);z.set(0,e),A.subVectors(z,y),A.y>0?o.dollyOut():A.y<0&&o.dollyIn(),y.copy(z),o.update();break;case 3:if(o.noPan===!0)return;if(I!==H.TOUCH_PAN)return;u.set(a.touches[0].pageX,a.touches[0].pageY),v.subVectors(u,t),o.pan(v.x,v.y),t.copy(u),o.update();break;default:I=H.NONE}}}function l(){o.enabled!==!1&&(o.dispatchEvent(N),I=H.NONE)}this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var m,n,o=this,p=1e-6,q=new THREE.Vector2,r=new THREE.Vector2,s=new THREE.Vector2,t=new THREE.Vector2,u=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector3,x=new THREE.Vector3,y=new THREE.Vector2,z=new THREE.Vector2,A=new THREE.Vector2,B=0,C=0,D=1,E=new THREE.Vector3,F=new THREE.Vector3,G=new THREE.Quaternion,H={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},I=H.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var J=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),K=J.clone().inverse(),L={type:"change"},M={type:"start"},N={type:"end"};this.rotateLeft=function(a){void 0===a&&(a=c()),C-=a},this.rotateUp=function(a){void 0===a&&(a=c()),B-=a},this.panLeft=function(a){var b=this.object.matrix.elements;w.set(b[0],b[1],b[2]),w.multiplyScalar(-a),E.add(w)},this.panUp=function(a){var b=this.object.matrix.elements;w.set(b[4],b[5],b[6]),w.multiplyScalar(a),E.add(w)},this.pan=function(a,b){var c=o.domElement===document?o.domElement.body:o.domElement;if(o.object instanceof THREE.PerspectiveCamera){var d=o.object.position,e=d.clone().sub(o.target),f=e.length();f*=Math.tan(o.object.fov/2*Math.PI/180),o.panLeft(2*a*f/c.clientHeight),o.panUp(2*b*f/c.clientHeight)}else o.object instanceof THREE.OrthographicCamera?(o.panLeft(a*(o.object.right-o.object.left)/c.clientWidth),o.panUp(b*(o.object.top-o.object.bottom)/c.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(a){void 0===a&&(a=d()),o.object instanceof THREE.PerspectiveCamera?D/=a:o.object instanceof THREE.OrthographicCamera?(o.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*a)),o.object.updateProjectionMatrix(),o.dispatchEvent(L)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(a){void 0===a&&(a=d()),o.object instanceof THREE.PerspectiveCamera?D*=a:o.object instanceof THREE.OrthographicCamera?(o.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/a)),o.object.updateProjectionMatrix(),o.dispatchEvent(L)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var a=this.object.position;x.copy(a).sub(this.target),x.applyQuaternion(J),m=Math.atan2(x.x,x.z),n=Math.atan2(Math.sqrt(x.x*x.x+x.z*x.z),x.y),this.autoRotate&&I===H.NONE&&this.rotateLeft(c()),m+=C,n+=B,m=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,m)),n=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n)),n=Math.max(p,Math.min(Math.PI-p,n));var b=x.length()*D;b=Math.max(this.minDistance,Math.min(this.maxDistance,b)),this.target.add(E),x.x=b*Math.sin(n)*Math.sin(m),x.y=b*Math.cos(n),x.z=b*Math.sin(n)*Math.cos(m),x.applyQuaternion(K),a.copy(this.target).add(x),this.object.lookAt(this.target),C=0,B=0,D=1,E.set(0,0,0),(F.distanceToSquared(this.object.position)>p||8*(1-G.dot(this.object.quaternion))>p)&&(this.dispatchEvent(L),F.copy(this.object.position),G.copy(this.object.quaternion))},this.reset=function(){I=H.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(L),this.update()},this.getPolarAngle=function(){return n},this.getAzimuthalAngle=function(){return m},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",j,!1),this.domElement.addEventListener("touchend",l,!1),this.domElement.addEventListener("touchmove",k,!1),window.addEventListener("keydown",i,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;var root,SceneHandler=function(a,b,c){var d=this;d.fileName=a,d.scene=b,d.clock=new THREE.Clock,d.deltaTime=0,void 0==c&&(c=!1),d.standard=c,d.root=new THREE.SEA3D(c),d.root.invertZ=!c,d.root.invertCamera=c,d.root.matrixAutoUpdate=!0,d.root.parser=THREE.SEA3D.AUTO,d.container=new THREE.Object3D,d.container.name="rootContainer",d.scene.add(d.container),d.bounding=void 0,d.onComplete=void 0,d.onProgress=void 0,d.castShadow=d.receiveShadow=!0,d.root.onComplete=function(){d._onComplete()},d.root.onProgress=function(a){d._onProgress(a)}};SceneHandler.prototype._onComplete=function(){var a=this,b=a.root.meshes.length;a.bounding=(new THREE.Box3).setFromObject(a.container);for(var c=0;b>c;c++)if(a.root.meshes[c].castShadow=a.castShadow,a.root.meshes[c].receiveShadow=a.receiveShadow,a.root.meshes[c].animation)for(var d=a.root.meshes[c].animation.animationSet.animations,e=0;e<d.length;e++){var f=d[e];if(f.dataList.length>1&&106==f.dataList[1].type)for(var g=f.dataList[1].data,h=0;h<g.length;h+=4)g[h]=-g[h],g[h+1]=-g[h+1]}root=a.root,a.container.add(a.root.container),SEA3D.AnimationHandler.stop(),a.onComplete&&a.onComplete()},SceneHandler.prototype._onProgress=function(a){var b=this;b.onProgress&&b.onProgress(a)},SceneHandler.groupIndex=0,SceneHandler.prototype.load=function(a,b){var c=this;b=b||SceneHandler.groupIndex+"",SceneHandler.groupIndex++,void 0==a?a=c.fileName:c.fileName=a;var d=new THREE.Group;d.name=b,c.root.container=d,c.root.load(a)},SceneHandler.prototype.update=function(){this.deltaTime=this.clock.getDelta(),void 0!=SEA3D.AnimationHandler&&SEA3D.AnimationHandler.update(this.deltaTime)},SceneHandler.prototype.play=function(a,b,c){var d,e=this;void 0==c&&(c=!1),a=a||"normal",b=b||1;for(var f=0;f<e.root.meshes.length;f++)d=e.root.meshes[f].animation,d&&d.animationSet.animations[a]&&(d.timeScale=b,d.play(a))},SceneHandler.prototype.stopAll=function(){SEA3D.AnimationHandler.setTime(0),SEA3D.AnimationHandler.stop()},SceneHandler.prototype.setTimeScale=function(a){for(var b in SEA3D.AnimationHandler.animations)SEA3D.AnimationHandler.animations[b].timeScale=a};var ztc=ztc||{};ztc.Tween={},ztc.Tween.currentTime=0,ztc.Tween.lastTime=0,ztc.Tween.isDom=!0,ztc.Tween.easeInOutQuad=function(a){a/=.5;var b=0,c=1;return 1>a?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b)},ztc.Tween.easeInQuad=function(a){var b=0,c=1;return c*a*a+b},ztc.Tween.easeOutQuad=function(a){var b=0,c=1;return-c*a*(a-2)+b},ztc.Tween.linear=function(a){return a},ztc.Tween.berp=function(a){return 0>a&&(a=0),a>1&&(a=1),a=(Math.sin(a*Math.PI*(.2+2.5*a*a*a))*Math.pow(1-a,2.2)+a)*(1+1.2*(1-a))},ztc.Tween.hermite=function(a){return a*a*(3-2*a)},ztc.Tween.sinerp=function(a){return Math.sin(a*Math.PI*.5)},ztc.Tween.coserp=function(a){return 1-Math.cos(a*Math.PI*.5)},ztc.Tween.easeInBack=function(a){return a*a*(2.70158*a-1.70158)},ztc.Tween.easeOutBack=function(a){var b=a-1;return b*b*(2.70158*b+1.70158)+1},ztc.Tween.easeInOutBack=function(a){var b=2*a,c=2.5949095;return 1>b?.5*(b*b*((c+1)*b-c)):(b-=2,.5*(b*b*((c+1)*b+c)+2))},ztc.Tween.kill=function(a){clearInterval(a)},ztc.Tween.getStyle=function(a,b){return a.currentStyle?a.currentStyle[b]:getComputedStyle(a,!1)[b]},ztc.Tween.fadeTo=function(a,b,c,d,e){null==c&&(c=ztc.Tween.linear);var f,g=0,h=0;return 0==a?(b(1),void 0!=e&&e(1),void 0!=d&&d()):(ztc.Tween.lastTime=Date.now(),h=setInterval(function(){ztc.Tween.currentTime=Date.now(),g+=(ztc.Tween.currentTime-ztc.Tween.lastTime)/1e3,ztc.Tween.lastTime=ztc.Tween.currentTime,g>=a&&(g=a),f=g/a;var i=c(f);b(i),void 0!=e&&e(i),1==f&&(clearInterval(h),null!=d&&d())},1)),h},ztc.Tween.action=function(a,b,c,d,e,f){var g=[];if(ztc.Tween.isDom){for(var h in c){var i=parseFloat(ztc.Tween.getStyle(a,h));"opacity"==h&&(i*=100),g.push({prop:h,old:i,delta:c[h]-i})}var j=ztc.Tween.fadeTo(b,function(b){for(var c=0;c<g.length;c++)"opacity"==g[c].prop?(a.style.filter="alpha:opacity("+(g[c].old+b*g[c].delta)+")",a.style.opacity=(g[c].old+b*g[c].delta)/100):a.style[g[c].prop]=g[c].old+b*g[c].delta+"px"},d,e,f)}else{for(var h in c)g.push({prop:h,old:a[h],delta:c[h]-a[h]});var j=ztc.Tween.fadeTo(b,function(b){for(var c=0;c<g.length;c++)a[g[c].prop]=g[c].old+b*g[c].delta},d,e,f)}return j},ztc.Tween.actionArray=function(a,b,c,d,e,f){var g=[];if(ztc.Tween.isDom){for(var h in a)for(var i in c){var j=parseFloat(ztc.Tween.getStyle(a[h],i));"opacity"==i&&(j*=100),g.push({obj:a[h],prop:i,old:j,delta:c[i]-j})}var k=ztc.Tween.fadeTo(b,function(a){for(var b=0;b<g.length;b++){var c=g[b];"opacity"==c.prop?(c.obj.style.filter="alpha:opacity("+(c.old+a*c.delta)+")",c.obj.style.opacity=(c.old+a*c.delta)/100):c.obj.style[c.prop]=c.old+a*c.delta+"px"}},d,e,f)}else{for(var i in c)for(var l in a)g.push({obj:l,prop:i,old:l[i],delta:c[i]-l[i]});var k=ztc.Tween.fadeTo(b,function(a){for(var b=0;b<g.length;b++){var c=g[b];c.obj[c.prop]=c.old+a*c.delta}},d,e,f)}return k},ztc.Tween.actionArrayProps=function(a,b,c,d,e,f){var g=[];if(ztc.Tween.isDom){for(var h in a){var i=[];for(var j in c[h]){var k=parseFloat(ztc.Tween.getStyle(a[h],j));"opacity"==j&&(k*=100),i.push({prop:j,old:k,delta:c[h][j]-k})}g.push(i)}var l=ztc.Tween.fadeTo(b,function(b){for(var c=0;c<a.length;c++){var d=a[c],e=g[c];for(var f in e)"opacity"==e[f].prop?(d.style.filter="alpha:opacity("+(e[f].old+b*e[f].delta)+")",d.style.opacity=(e[f].old+b*e[f].delta)/100):d.style[e[f].prop]=e[f].old+b*e[f].delta+"px"}},d,e,f)}else{for(var j in a){var m=[];for(var n in c[j])m.push({prop:n,old:a[j][n],delta:c[j][n]-a[j][n]});g.push(m)}var l=ztc.Tween.fadeTo(b,function(b){for(var c in a)for(var d in g[c])a[c][g[c][d].prop]=g[c][d].old+b*g[c][d].delta},d,e,f)}return l},function(a){function b(a,b,c){a[b]&&a.enabled&&a[b](c)}function c(a){try{return new THREE.Vector2(a.touches?a.touches[0].clientX:a.clientX,a.touches?a.touches[0].clientY:a.clientY)}catch(a){return null}}function d(a,b){for(var c=0;c<a.length;c++)a[c]==b&&a.splice(c,1)}var e=function(a,b){var c=this;b=b||{},void 0==b.seaStandard&&(b.seaStandard=!1),c.container=a;var d=b.rendererConfig||{antialias:!0,alpha:!0};c.renderer=new THREE.WebGLRenderer(d),c.container.appendChild(c.renderer.domElement),c.camera=new THREE.PerspectiveCamera(50,a.offsetWidth/a.offsetHeight,1,1e4),c.camera.position.set(0,50,400),b.seaStandard&&c.camera.scale.set(-1,1,1),c.cameraController,c.scene=new THREE.Scene,c.sh=new SceneHandler("",c.scene,b.seaStandard),c.sea=c.sh.root,c.rootContainer=c.sh.container,c.mouseMovement=new THREE.Vector2(0,0),c.width=100,c.height=100,c.stageScale=window.t?window.t.stageScale:1,c.pause=!1,c.isMouseDown=!1,c.isAnimating=!1,c.debug=b.debug||!1,c.start=[],c.update=[],c.postUpdate=[],c.progress=[],c.loadComplete=[],c.picked=[],c.keydown=[],c.keyup=[],c.mousedown=[],c.mousemove=[],c.mouseup=[],c.enabledPickEvent=!0,c.canPicked=[],c.components=[],c.animations=[],c.init()};e.START="start",e.UPDATE="update",e.POSTUPDATE="postUpdate",e.PROGRESS="progress",e.LOADCOMPLETE="loadComplete",e.PICKED="picked",e.KEYDOWN="keydown",e.KEYUP="keyup",e.MOUSEDOWN="mousedown",e.MOUSEMOVE="mousemove",e.MOUSEUP="mouseup",e.instance=null,e.prototype.init=function(){var a=this;e.instance||(e.instance=a),a.setSize(),a.addEvents(),a._start(),a._update(),window.addEventListener("resize",function(){a.width=game.container.offsetWidth,a.height=game.container.offsetHeight,a.setSize(a.width,a.height)})},e.prototype.setOrbitController=function(){this.cameraController=new THREE.OrbitControls(this.camera,this.container),this.cameraController.zoomSpeed=.5};var f,g,h;e.prototype.addEvents=function(){function a(a){k.invokeComponentFunction(this,"onKeyDown",a),k.invoke("keydown",a)}function b(a){k.invokeComponentFunction(this,"onKeyUp",a),k.invoke("keyup",a)}function d(a){a.preventDefault(),k.isMouseDown=!0,f=c(a),h=f;var b=k.getPickObject(f);k.currentPicked=b,h=g=f,k.invokeComponentFunction(b,"onMouseDown",a),k.invoke("mousedown",a)}function i(a){a.preventDefault(),g=c(a),h&&(k.mouseMovement=g.clone().sub(h),h=g),k.invokeComponentFunction(k.currentPicked,"onMouseMove",a),k.invoke("mousemove",a)}function j(a){if(a.preventDefault(),k.invokeComponentFunction(k.currentPicked,"onMouseUp",a),k.invoke("mouseup",a),a.touches||(g=c(a)),(0==a.button||a.touches)&&(k.enabledPickEvent||k.debug)&&f.distanceTo(g)<5){var b=k.currentPicked;b&&(k.invokeComponentFunction(b,"onPicked",a),k.invoke(e.PICKED,b))}k.currentPicked=null,k.isMouseDown=!1}var k=this;k.container.addEventListener("mousedown",d,!1),k.container.addEventListener("mousemove",i,!1),k.container.addEventListener("mouseup",j,!1),k.container.addEventListener("touchstart",d,!1),k.container.addEventListener("touchmove",i,!1),k.container.addEventListener("touchend",j,!1),document.addEventListener("keydown",a,!1),document.addEventListener("keyup",b,!1)},e.prototype.getPickObject=function(a,b){var c=this,d=(a.x-c.container.offsetLeft)/(c.width*c.stageScale)*2-1,e=2*-((a.y-c.container.offsetTop)/(c.height*c.stageScale))+1,f=new THREE.Vector3(d,e,1);f.unproject(c.camera);var g=new THREE.Raycaster(c.camera.position,f.sub(c.camera.position).normalize());b=b||(0==c.canPicked.length?c.scene.children:c.canPicked);var h=g.intersectObjects(b,!0);if(h.length>0){for(var i=0;i<h.length;i++){var j=h[i].object;if(!("mouseEnabled"in j)||j.mouseEnabled)return j}return null}return null},e.prototype.registerComponents=function(a,b){b=b||"js/coms/";for(var c=0;c<a.length;c++){var d=a[c];utils.include(b+d+".js")}console.log("registe "+a)},e.prototype.unregisterComponents=function(a){for(var b=0;b<a.length;b++)window[a[b]]=void 0},THREE.Object3D.prototype.addComponent=function(a){var c=this;if(window[a]){var d=new window[a];d.object=this,d.name=a,d.enabled=!0,c.components=this.components||[],c.components.push(d),e.instance.components.push(d),b(d,"start")}else setTimeout(function(){c.addComponent(a)},0)},THREE.Object3D.prototype.getComponent=function(a){if(this.components)for(var b=0;b<this.components.length;b++){var c=this.components[b];if(c.name==a)return c}return null},THREE.Object3D.prototype.removeComponent=function(a){if(this.components){var c=this.getComponent(a);b(c,"onRemove");var d=e.instance.components.indexOf(c);e.instance.components.splice(d,1),d=this.components.indexOf(c),this.components.splice(d,1)}},e.prototype.setSize=function(a,b){void 0==a&&(a=this.container.offsetWidth),void 0==b&&(b=this.container.offsetHeight),this.width=a,this.height=b,this.renderer.setSize(a,b),this.renderer.setPixelRatio(window.devicePixelRatio?window.devicePixelRatio:1),this.camera.aspect=a/b,this.camera.updateProjectionMatrix()},e.prototype.getDeltaTime=function(){return this.sh.deltaTime},e.prototype.getTime=function(){return this.sh.clock.getElapsedTime()},e.prototype.addEventListener=function(a,b){this[a].push(b)},e.prototype.removeEventListener=function(a,b){d(this[a],b)},e.prototype.invoke=function(a,b){var c=this[a];this.debug&&a!=e.UPDATE&&a!=e.POSTUPDATE&&a!=e.MOUSEMOVE&&(a==e.PROGRESS?console.log("-> ",a," event:",b.progress," type:",b.type):console.log("-> ",a," event:",b));for(var d=0;d<c.length;d++)c[d](b)},e.prototype._start=function(){this.invoke("start")},e.prototype._update=function(){if(requestAnimationFrame(this._update.bind(this)),!this.pause){var a=1e3*this.getDeltaTime();this.sh.update(),THREE.Sound3D&&THREE.Sound3D.update(this.camera),this.invokeComponentFunction(this,"update"),this.invoke(e.UPDATE,a);for(var b=0;b<this.animations.length;b++)this.animations[b].update(a);this.renderer.render(this.scene,this.camera),this.invoke(e.POSTUPDATE,a)}},e.prototype.invokeComponentFunction=function(a,b,c){if(a&&a.components)for(var d=0;d<a.components.length;d++){var e=a.components[d];e.enabled&&e[b]&&e[b](c)}},e.prototype.load=function(a,b){var c=this;c.sh.load(a,b),c.sh.onProgress=function(a){c.invoke(e.PROGRESS,a)},c.sh.onComplete=function(){c.invoke(e.LOADCOMPLETE,b)}},e.prototype.clearScene=function(){for(var a=this,b=a.rootContainer;b.children.length>0;)b.remove(b.children[0]);a.sea.objects={}},e.prototype.removeGroup=function(a){this.rootContainer.remove(this.getGroup(a))},e.prototype.getGroup=function(a){return this.rootContainer.getObjectByName(a)},e.prototype.letTextureEmissive=function(a,b,c){a=a||1,b=b||.6;var d=this.sh.root.materials;if(d)for(var e=0;e<d.length;e++){if(c&&-1!=c.indexOf(d[e].name))return;d[e].emissive=new THREE.Color(d[e].color).multiplyScalar(d[e].map?a:b)}},e.prototype.playGeneralAnimation=function(a,b,c){a=a||"general",game.sh.play(a,b,c)},e.prototype.printCameraInfo=function(){var a=this.camera.position,b=this.camera.rotation,c=this.cameraController.target;console.log("position:",a.x.toFixed(2)+","+a.y.toFixed(2)+","+a.z.toFixed(2),"rotation:",b.x.toFixed(2)+","+b.y.toFixed(2)+","+b.z.toFixed(2),"target:",c.x.toFixed(2)+","+c.y.toFixed(2)+","+c.z.toFixed(2))},e.prototype.setCamera=function(a){this.camera=a,this.cameraController.object=this.camera},a.Game=e}(window),THREE.MorphAnimation.prototype.update=function(){var a=0,b=0;return function(c){if(this.isPlaying!==!1){this.currentTime+=c,this.loop===!0&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var d=this.duration/this.frames,e=Math.floor(this.currentTime/d);e!=b&&(this.mesh.morphTargetInfluences[a]=0,this.mesh.morphTargetInfluences[b]=1,this.mesh.morphTargetInfluences[e]=0,a=b,b=e),this.mesh.morphTargetInfluences[e]=this.currentTime%d/d,a!=e&&(this.mesh.morphTargetInfluences[a]=1-this.mesh.morphTargetInfluences[e])}}}(),SEA3D.AnimationHandler.prototype.updateAnimation=function(a){for(var b=this.animationSet.dataCount,c=this.animationSet.animations,d=void 0==a?this.currentState.node:this.getStateByName(a).node,e=0;b>e;e++)for(var f=0;f<c.length;f++){var g,h=c[f],i=this.states[f],j=h.dataList[e],k=SEA3D.Animation.DefaultLerpFuncs[j.kind];if(0==f){g=d.getInterpolationFrame(d.dataList[e],k);var l=this.timeScale>=0?Math.floor(d.frame):Math.ceil(d.frame);if(l!=this._lastFrame){this._lastFrame=l;var m=l+"";this.keyframeEvents&&this.keyframeEvents[m]&&this.keyframeEvents[m](),!d.repeat&&(this.timeScale>0&&d.frame==d.numFrames-1||this.timeScale<0&&0==d.frame)&&(this.onComplete&&this.onComplete(this),this.pause())}}h!=d&&i.weight>0&&k(g.data,h.getInterpolationFrame(j,k).data,i.weight),this.updateAnimationFrame&&this.updateAnimationFrame(g,j.kind)}},SEA3D.AnimationHandler.update=function(a){for(var b=0,c=SEA3D.AnimationHandler.animations.length;c>b;b++)SEA3D.AnimationHandler.animations[b]&&SEA3D.AnimationHandler.animations[b].update(1e3*a)};var utils=utils||{};utils.fixMorphTargets=function(a){if(a.morphTargets)for(var b,c,d=0;d<a.morphTargets.length;d++){b=a.morphTargets[d];for(var e=0;e<b.vertices.length;e+=3)c=b.vertices[e+1],b.vertices[e+1]=b.vertices[e+2],b.vertices[e+2]=c}},utils.morphObject=function(a,b){if(a.geometry instanceof THREE.BufferGeometry){var c=(new THREE.Geometry).fromBufferGeometry(a.geometry);utils.fixMorphTargets(c),a.geometry=c}var d=new THREE.MorphAnimation(a);d.duration=b.duration||1e3,0==b.loop&&(d.loop=!1),d.play(),Game.instance.animations.push(d)},utils.include=function(a,b){(b||"http:"!=window.location.protocol)&&document.write("<script src='"+a+"?v="+Math.random()+"'></script>")},utils.sameTransform=function(a,b,c,d,e,f){var g=c?-1:1;if(d||a.position.set(b.position.x,b.position.y,b.position.z),!e){var h=b.quaternion;a.quaternion.set(g*h.x,g*h.y,h.z,h.w)}f||a.scale.set(b.scale.x,b.scale.y,b.scale.z)},utils.transformTo=function(a,b,c,d,e,f){if(!ztc.Tween)return void console.warn("utils.transformTo: Do not have ztc.Tween!");d=d||ztc.Tween.easeOutQuad;var g=new THREE.Quaternion,h=a.quaternion.clone(),i=b.quaternion;ztc.Tween.isDom=!1,c||(c=1),ztc.Tween.actionArrayProps([a.position],c,[{x:b.position.x,y:b.position.y,z:b.position.z}],d,e,function(b){THREE.Quaternion.slerp(h,i,g,b),a.quaternion.set(g.x,g.y,g.z,g.w),f&&f(b)})},utils.toScreenPosition=function(a,b){var c=new THREE.Vector3(a.x,a.y,a.z),d=.5*Game.instance.width*g.stageScale,e=.5*Game.instance.height*g.stageScale;return c.project(b),c.x=c.x*d+d,c.y=-(c.y*e)+e,new THREE.Vector2(c.x,c.y)},utils.toWorldPosition=function(a,b,c){c=c||1;var d=Game.instance,e=(a.x-s.container.offsetLeft)/(d.width*d.stageScale)*2-1,f=2*-((a.y-s.container.offsetTop)/(d.height*d.stageScale))+1,g=new THREE.Vector3(e,f,c);return g.unproject(b)},utils.setAnimationTime=function(a,b,c){if(b in a.states)try{0>c?c=0:c>1&&(c=1);var d=a.states[b].node.duration;a.stop(),a.states[b].node.setTime(c*d),a.updateAnimation(b)}catch(e){console.log(e.message)}else console.warn("Not have "+b+" state!")},utils.setAllAnimationTime=function(a,b){for(var c=0;c<Game.instance.sea.meshes.length;c++){var d=Game.instance.sea.meshes[c];d.animation&&utils.setAnimationTime(d.animation,a,b)}},utils.followAnimation=function(a,b,c,d,e){function f(){utils.sameTransform(a,b,d)}b.animation.play(c),Game.instance.addEventListener(Game.UPDATE,f),b.animation.onComplete=function(){b.animation.onComplete=null,Game.instance.removeEventListener(Game.UPDATE,f),e&&e()}};